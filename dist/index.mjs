var X=Object.defineProperty;var c=(e,t)=>X(e,"name",{value:t,configurable:!0});import{inspect as ee}from"node:util";import F from"node:os";import{expect as Ee}from"expect";let g=!0;const w=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};let T=0;if(w.process&&w.process.env&&w.process.stdout){const{FORCE_COLOR:e,NODE_DISABLE_COLORS:t,NO_COLOR:o,TERM:s,COLORTERM:n}=w.process.env;t||o||e==="0"?g=!1:e==="1"||e==="2"||e==="3"?g=!0:s==="dumb"?g=!1:"CI"in w.process.env&&["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(i=>i in w.process.env)?g=!0:g=process.stdout.isTTY,g&&(process.platform==="win32"||n&&(n==="truecolor"||n==="24bit")?T=3:s&&(s.endsWith("-256color")||s.endsWith("256"))?T=2:T=1)}let R={enabled:g,supportLevel:T};function $(e,t,o=1){const s=`\x1B[${e}m`,n=`\x1B[${t}m`,i=new RegExp(`\\x1b\\[${t}m`,"g");return a=>R.enabled&&R.supportLevel>=o?s+(""+a).replace(i,s)+n:""+a}c($,"kolorist");const L=$(2,22),A=$(31,39),M=$(32,39),P=$(33,39),B=c(e=>Number.isFinite(e)?e:0,"toZeroIfInfinity");function te(e){return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5%24),minutes:Math.trunc(e/6e4%60),seconds:Math.trunc(e/1e3%60),milliseconds:Math.trunc(e%1e3),microseconds:Math.trunc(B(e*1e3)%1e3),nanoseconds:Math.trunc(B(e*1e6)%1e3)}}c(te,"parseNumber");function ne(e){return{days:e/86400000n,hours:e/3600000n%24n,minutes:e/60000n%60n,seconds:e/1000n%60n,milliseconds:e%1000n,microseconds:0n,nanoseconds:0n}}c(ne,"parseBigint");function se(e){switch(typeof e){case"number":{if(Number.isFinite(e))return te(e);break}case"bigint":return ne(e)}throw new TypeError("Expected a finite number or bigint")}c(se,"parseMilliseconds");const oe=c(e=>e===0||e===0n,"isZero"),re=c((e,t)=>t===1||t===1n?e:`${e}s`,"pluralize"),ce=1e-7,ie=24n*60n*60n*1000n;function S(e,t){const o=typeof e=="bigint";if(!o&&!Number.isFinite(e))throw new TypeError("Expected a finite number or bigint");t={...t};const s=e<0?"-":"";e=e<0?-e:e,t.colonNotation&&(t.compact=!1,t.formatSubMilliseconds=!1,t.separateMilliseconds=!1,t.verbose=!1),t.compact&&(t.unitCount=1,t.secondsDecimalDigits=0,t.millisecondsDecimalDigits=0);let n=[];const i=c((f,m)=>{const h=Math.floor(f*10**m+ce);return(Math.round(h)/10**m).toFixed(m)},"floorDecimals"),a=c((f,m,h,d)=>{if(!((n.length===0||!t.colonNotation)&&oe(f)&&!(t.colonNotation&&h==="m"))){if(d??=String(f),t.colonNotation){const y=d.includes(".")?d.split(".")[0].length:d.length,D=n.length>0?2:1;d="0".repeat(Math.max(0,D-y))+d}else d+=t.verbose?" "+re(m,f):h;n.push(d)}},"add"),r=se(e),l=BigInt(r.days);if(t.hideYearAndDays?a(BigInt(l)*24n+BigInt(r.hours),"hour","h"):(t.hideYear?a(l,"day","d"):(a(l/365n,"year","y"),a(l%365n,"day","d")),a(Number(r.hours),"hour","h")),a(Number(r.minutes),"minute","m"),!t.hideSeconds)if(t.separateMilliseconds||t.formatSubMilliseconds||!t.colonNotation&&e<1e3&&!t.subSecondsAsDecimals){const f=Number(r.seconds),m=Number(r.milliseconds),h=Number(r.microseconds),d=Number(r.nanoseconds);if(a(f,"second","s"),t.formatSubMilliseconds)a(m,"millisecond","ms"),a(h,"microsecond","\xB5s"),a(d,"nanosecond","ns");else{const y=m+h/1e3+d/1e6,D=typeof t.millisecondsDecimalDigits=="number"?t.millisecondsDecimalDigits:0,Q=y>=1?Math.round(y):Math.ceil(y),v=D?y.toFixed(D):Q;a(Number.parseFloat(v),"millisecond","ms",v)}}else{const f=(o?Number(e%ie):e)/1e3%60,m=typeof t.secondsDecimalDigits=="number"?t.secondsDecimalDigits:1,h=i(f,m),d=t.keepDecimalsOnWholeSeconds?h:h.replace(/\.0+$/,"");a(Number.parseFloat(d),"second","s",d)}if(n.length===0)return s+"0"+(t.verbose?" milliseconds":"ms");const u=t.colonNotation?":":" ";return typeof t.unitCount=="number"&&(n=n.slice(0,Math.max(t.unitCount,1))),s+n.join(u)}c(S,"prettyMilliseconds");const b=`
`,ae="    ",{log:k,error:p}=console,le=M("\u2714"),ue=A("\u2716"),fe=P("\u2022"),H=c(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return L(`${t}:${o}:${s}`)},"formatTimestamp"),_=c(({startTime:e,timeout:t,endTime:o})=>{const s=(o||Date.now())-e;let n=S(s);return t&&(n+=` / ${S(t)}`),s<50?"":` ${L(`(${n})`)}`},"prettyDuration"),de=c(e=>e.replaceAll(/^/gm,ae),"indentMultiline"),x=c(e=>{const{title:t,attempt:o,retry:s}=e;let n=`${t+_(e)}`;return s>1&&(n+=L(` (${o}/${s})`)),n},"getTestTitle"),I=c((e,t,o)=>{let s=`${H()} ${ue} ${x(e)}`;o&&(s+=` [${o}]`),p(s),p(`${de(ee(t))}
`)},"logTestFail"),me=c(e=>{k(`${H()} ${le} ${x(e)}`)},"logTestSuccess"),he=c(e=>{if(e.length===0)return;const t=[];let o=0,s=0,n,i;for(const r of e)r.startTime&&(!n||n>r.startTime)&&(n=r.startTime),r.endTime===void 0?t.push(r):((!i||i<r.endTime)&&(i=r.endTime),r.error?s+=1:o+=1);let a="";if(t.length>0){for(const r of t)a+=`${b}${fe} ${r.title+_(r)}`;a+=b}a+=`${b}${L(S((i??Date.now())-n))}`,a+=b+(o>0?M:L)(`${o.toLocaleString()} passed`),s>0&&(a+=b+A(`${s.toLocaleString()} failed`)),t.length>0&&(a+=b+P(`${t.length.toLocaleString()} pending`)),a+=b,k(a)},"logReport"),ge=c(()=>{let e,t;const o=new Promise((s,n)=>{e=s,t=n});return Object.assign(o,{resolve:e,reject:t})},"createDeferred"),be=c((e,t)=>{const o=ge(),s=setTimeout(()=>{const n=new Error(`Timeout: ${e}ms`);t?.abort(n),o.reject(n)},e);return Object.assign(o,{timeoutId:s})},"setTimer"),O=c((e,t,o)=>{if(!e||!("then"in e)||t===void 0||t===0)return e;const s=be(t,o);return Promise.race([e,s]).finally(()=>{clearTimeout(s.timeoutId)})},"timeLimitFunction"),C=c(e=>{const t=[];return{addHook:c(n=>{t.push(n)},"addHook"),runHooks:c(async(...n)=>{for(const i of t)try{await i(...n)}catch(a){await e(a)}},"runHooks")}},"createHook"),ye=c(async(e,t)=>{for(let o=1;o<=t;o+=1)try{await e(o);return}catch(s){if(o===t)throw s}},"retry"),j=c(e=>(e&&typeof e=="object"&&"matcherResult"in e&&e.constructor.name==="JestAssertionError"&&delete e.matcherResult,e),"patchJestAssertionError"),q=c(async(e,t)=>{const{testFunction:o,timeout:s}=e,n=C(r=>{I(e,r,"onTestFail")}),i=c(async r=>{await n.runHooks(r)},"handleError"),a=C(async r=>{I(e,j(r),"onTestFinish")});try{await ye(async r=>{e.attempt=r,e.startTime=Date.now();const l=new AbortController;let u;t&&(u=c(()=>{l.signal.aborted||l.abort(t.abortController.signal.reason)},"handleParentAbort"),t.abortController.signal.addEventListener("abort",u),t.abortController.signal.aborted&&u());try{await O(o({signal:l.signal,onTestFail:n.addHook,onTestFinish:a.addHook}),s,l)}catch(f){throw I(e,j(f)),await i(f),f}finally{t&&u&&t.abortController.signal.removeEventListener("abort",u),l.signal.aborted||l.abort(),await a.runHooks(),e.endTime=Date.now()}me(e)},e.retry)}catch(r){e.error=r,process.exitCode=1}},"runTest"),V=[];process.on("exit",()=>{he(V)});const Y=process.env.TESTONLY,W=c((e,t)=>(async(o,s,n)=>{if(e&&(o=`${e} ${o}`),Y&&!o.includes(Y))return;const i={title:o,testFunction:s,retry:1};n!==void 0&&(typeof n=="number"?i.timeout=n:(i.timeout=n?.timeout,n?.retry&&(i.retry=n?.retry))),V.push(i);const r=c(async()=>{if(t?.concurrencyLimiter){const l=await t.concurrencyLimiter.acquire();try{await q(i,t)}finally{l()}}else await q(i,t)},"executeTest")();t&&t.pendingTests.push(r),await r}),"createTest"),we=c(async e=>{for(;e.length>0;){const t=e.splice(0);await Promise.all(t)}},"waitAllPromises"),Te=c(e=>("default"in e&&(e=e.default),"default"in e&&(e=e.default),e),"unwrapModule"),N=c(e=>{let t=typeof e=="number"?e:G(),o=0;const s=[];let n;return e==="auto"&&(n=setInterval(()=>{const l=G();if(l!==t)for(t=l;s.length>0&&o<t;){const u=s.shift();u&&(o+=1,u())}},5e3),n.unref()),{acquire:c(()=>o<t?(o+=1,Promise.resolve(()=>{o-=1;const l=s.shift();l&&(o+=1,l())})):new Promise(l=>{s.push(()=>{l(()=>{o-=1;const u=s.shift();u&&(o+=1,u())})})}),"acquire"),setLimit:c(l=>{for(t=l;s.length>0&&o<t;){const u=s.shift();u&&(o+=1,u())}},"setLimit"),cleanup:c(()=>{n&&clearInterval(n)},"cleanup")}},"createSemaphore"),G=c(()=>{const e=F.cpus().length,t=F.loadavg()[0];return Math.max(1,Math.min(Math.floor(e*(1-Math.min(t/e,.8))),e))},"calculateAutoLimit"),U=c((e,t)=>(async(o,s,n)=>{e&&(o=`${e} ${o}`);const i=E(o,n?.parallel,n?.timeout);await c(async()=>{if(t?.concurrencyLimiter){const r=await t.concurrencyLimiter.acquire();try{await i.run(s,t)}finally{r()}}else await i.run(s,t)},"executeDescribe")()}),"createDescribe"),J=c((e,t)=>((o,...s)=>{const n=c(()=>{const i=E(e);return i.run(async()=>Te(await o).apply(i,s),t)},"executeTestSuite");return t?.concurrencyLimiter?t.concurrencyLimiter.acquire().then(i=>n().finally(i)):n()}),"createRunTestSuite"),Z=W(),z=U(),K=J(),E=c((e,t,o)=>{let s;t!==void 0&&(t===!0?s=void 0:t===!1?s=N(1):typeof t=="number"?s=N(t):t==="auto"&&(s=N("auto")));const n=new AbortController,i={pendingTests:[],callbacks:{onFinish:[]},concurrencyLimiter:s,abortController:n,timeout:o,run:c(async(a,r)=>{let l;r&&(l=c(()=>{n.signal.aborted||n.abort(r.abortController.signal.reason)},"handleParentAbort"),r.abortController.signal.addEventListener("abort",l),r.abortController.signal.aborted&&l());try{const u=(async()=>{await a(i.api),await we(i.pendingTests)})();r&&r.pendingTests.push(u),await O(u,o,n)}catch(u){p(u),process.exitCode=1}finally{r&&l&&r.abortController.signal.removeEventListener("abort",l),n.signal.aborted||n.abort(),s&&s.cleanup();for(const u of i.callbacks.onFinish)try{await u()}catch(f){p(f),process.exitCode=1}}},"run")};return i.api={signal:n.signal,test:e?W(`${e} \u203A`,i):Z,describe:e?U(`${e} \u203A`,i):z,runTestSuite:e?J(e,i):K,onFinish:c(a=>{i.callbacks.onFinish.push(a)},"onFinish")},i},"createContext"),Le=E(),De=c((e,t,o)=>{const s=typeof e=="string"?e:void 0,n=typeof e=="string"?t:e,i=typeof e=="string"?o:void 0;return c(async function(...r){const l=this||Le;s?await l.api.describe(s,u=>n(u,...r),i):await n(l.api,...r)},"testSuiteWrapper")},"testSuite");export{z as describe,Ee as expect,K as runTestSuite,Z as test,De as testSuite};
