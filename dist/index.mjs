import{expect as J}from"expect";let f=!0;const h=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};let p=0;if(h.process&&h.process.env&&h.process.stdout){const{FORCE_COLOR:t,NODE_DISABLE_COLORS:e,TERM:o}=h.process.env;e||t==="0"?f=!1:t==="1"?f=!0:o==="dumb"?f=!1:"CI"in h.process.env&&["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(r=>r in h.process.env)?f=!0:f=process.stdout.isTTY,f&&(p=o&&o.endsWith("-256color")?2:1)}let w={enabled:f,supportLevel:p};function g(t,e,o=1){const r=`\x1B[${t}m`,i=`\x1B[${e}m`,n=new RegExp(`\\x1b\\[${e}m`,"g");return s=>w.enabled&&w.supportLevel>=o?r+(""+s).replace(n,r)+i:""+s}const T=g(2,22),b=g(31,39),D=g(32,39),$=g(33,39);function P(t){if(typeof t!="number")throw new TypeError("Expected a number");const e=t>0?Math.floor:Math.ceil;return{days:e(t/864e5),hours:e(t/36e5)%24,minutes:e(t/6e4)%60,seconds:e(t/1e3)%60,milliseconds:e(t)%1e3,microseconds:e(t*1e3)%1e3,nanoseconds:e(t*1e6)%1e3}}const _=(t,e)=>e===1?t:`${t}s`,V=1e-7;function y(t,e={}){if(!Number.isFinite(t))throw new TypeError("Expected a finite number");e.colonNotation&&(e.compact=!1,e.formatSubMilliseconds=!1,e.separateMilliseconds=!1,e.verbose=!1),e.compact&&(e.secondsDecimalDigits=0,e.millisecondsDecimalDigits=0);const o=[],r=(s,c)=>{const a=Math.floor(s*10**c+V);return(Math.round(a)/10**c).toFixed(c)},i=(s,c,a,l)=>{if((o.length===0||!e.colonNotation)&&s===0&&!(e.colonNotation&&a==="m"))return;l=(l||s||"0").toString();let m,u;if(e.colonNotation){m=o.length>0?":":"",u="";const A=l.includes(".")?l.split(".")[0].length:l.length,F=o.length>0?2:1;l="0".repeat(Math.max(0,F-A))+l}else m="",u=e.verbose?" "+_(c,s):a;o.push(m+l+u)},n=P(t);if(i(Math.trunc(n.days/365),"year","y"),i(n.days%365,"day","d"),i(n.hours,"hour","h"),i(n.minutes,"minute","m"),e.separateMilliseconds||e.formatSubMilliseconds||!e.colonNotation&&t<1e3)if(i(n.seconds,"second","s"),e.formatSubMilliseconds)i(n.milliseconds,"millisecond","ms"),i(n.microseconds,"microsecond","\xB5s"),i(n.nanoseconds,"nanosecond","ns");else{const s=n.milliseconds+n.microseconds/1e3+n.nanoseconds/1e6,c=typeof e.millisecondsDecimalDigits=="number"?e.millisecondsDecimalDigits:0,a=s>=1?Math.round(s):Math.ceil(s),l=c?s.toFixed(c):a;i(Number.parseFloat(l),"millisecond","ms",l)}else{const s=t/1e3%60,c=typeof e.secondsDecimalDigits=="number"?e.secondsDecimalDigits:1,a=r(s,c),l=e.keepDecimalsOnWholeSeconds?a:a.replace(/\.0+$/,"");i(Number.parseFloat(l),"second","s",l)}if(o.length===0)return"0"+(e.verbose?" milliseconds":"ms");if(e.compact)return o[0];if(typeof e.unitCount=="number"){const s=e.colonNotation?"":" ";return o.slice(0,Math.max(e.unitCount,1)).join(s)}return e.colonNotation?o.join(""):o.join(" ")}const d=`
`,{log:I,error:x}=console,B=D("\u2714"),j=b("\u2716"),v=$("\u2022"),E=({startTime:t,timeout:e,endTime:o})=>{const r=(o||Date.now())-t;let i=y(r);return e&&(i+=` / ${y(e)}`),r<50?"":` ${T(`(${i})`)}`},N=t=>{const{title:e,error:o}=t;(o?x:I)(`${o?j:B} ${e+E(t)}`)},G=t=>{if(t.length===0)return;const e=[];let o=0,r=0,i,n;for(const c of t)c.startTime&&(!i||i>c.startTime)&&(i=c.startTime),c.endTime===void 0?e.push(c):((!n||n<c.endTime)&&(n=c.endTime),c.error?r+=1:o+=1);let s="";if(e.length>0){for(const c of e)s+=`${d}${v} ${c.title+E(c)}`;s+=d}s+=`${d}${T(y(n-i))}`,s+=d+(o>0?D:T)(`${o.toLocaleString()} passed`),r>0&&(s+=d+b(`${r.toLocaleString()} failed`)),e.length>0&&(s+=d+$(`${e.length.toLocaleString()} pending`)),s+=d,I(s)},U=async(t,e)=>new Promise((o,r)=>{e.timeoutId=setTimeout(()=>{r(new Error(`Timeout: ${t}ms`))},t)}),k=async t=>{const{testFunction:e,timeout:o}=t;let r;const i={onTestFail(n){r=n}};t.startTime=Date.now();try{if(o){const n={timeoutId:void 0};try{await Promise.race([e(i),U(o,n)])}finally{clearTimeout(n.timeoutId)}}else await e(i);t.endTime=Date.now(),N(t)}catch(n){t.endTime=Date.now(),t.error=n,N(t),n&&typeof n=="object"&&"matcherResult"in n&&n.constructor.name==="JestAssertionError"&&delete n.matcherResult,x(n),process.exitCode=1,typeof r=="function"&&r(n)}},S=[];process.on("exit",()=>{G(S)});function R(t,e){return async function(r,i,n){t&&(r=`${t} ${r}`);const s={title:r,testFunction:i,timeout:n};S.push(s);const c=k(s);e&&e.push(c),await c}}async function W(t){for(;t.length>0;){const e=t.splice(0);await Promise.all(e)}}function C(t,e){return async function(r,i){t&&(r=`${t} ${r}`);const n=[];try{const s=(async()=>{const c={test:R(`${r} \u203A`,n),describe:C(`${r} \u203A`,n),runTestSuite:(a,...l)=>{const m=(async()=>{let u=await a;return"default"in u&&(u=u.default),"default"in u&&(u=u.default),u.apply(c,l)})();return n.push(m),m}};await i(c),await W(n)})();e&&e.push(s),await s}catch(s){console.error(s)}}}const L=R(),M=C(),O={describe:M,test:L,runTestSuite:async(t,...e)=>{let o=await t;return"default"in o&&(o=o.default),"default"in o&&(o=o.default),o.apply(O,e)}};function Y(t){return function(...e){return t(this||O,...e)}}export{M as describe,J as expect,L as test,Y as testSuite};
