"use strict";var K=Object.defineProperty;var c=(e,t)=>K(e,"name",{value:t,configurable:!0});var Q=require("node:util"),F=require("node:os"),X=require("expect");let y=!0;const w=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};let b=0;if(w.process&&w.process.env&&w.process.stdout){const{FORCE_COLOR:e,NODE_DISABLE_COLORS:t,NO_COLOR:n,TERM:s,COLORTERM:o}=w.process.env;t||n||e==="0"?y=!1:e==="1"||e==="2"||e==="3"?y=!0:s==="dumb"?y=!1:"CI"in w.process.env&&["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(i=>i in w.process.env)?y=!0:y=process.stdout.isTTY,y&&(process.platform==="win32"||o&&(o==="truecolor"||o==="24bit")?b=3:s&&(s.endsWith("-256color")||s.endsWith("256"))?b=2:b=1)}let x={enabled:y,supportLevel:b};function D(e,t,n=1){const s=`\x1B[${e}m`,o=`\x1B[${t}m`,i=new RegExp(`\\x1b\\[${t}m`,"g");return r=>x.enabled&&x.supportLevel>=n?s+(""+r).replace(i,s)+o:""+r}c(D,"kolorist");const L=D(2,22),R=D(31,39),M=D(32,39),A=D(33,39),B=c(e=>Number.isFinite(e)?e:0,"toZeroIfInfinity");function ee(e){return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5%24),minutes:Math.trunc(e/6e4%60),seconds:Math.trunc(e/1e3%60),milliseconds:Math.trunc(e%1e3),microseconds:Math.trunc(B(e*1e3)%1e3),nanoseconds:Math.trunc(B(e*1e6)%1e3)}}c(ee,"parseNumber");function te(e){return{days:e/86400000n,hours:e/3600000n%24n,minutes:e/60000n%60n,seconds:e/1000n%60n,milliseconds:e%1000n,microseconds:0n,nanoseconds:0n}}c(te,"parseBigint");function ne(e){switch(typeof e){case"number":{if(Number.isFinite(e))return ee(e);break}case"bigint":return te(e)}throw new TypeError("Expected a finite number or bigint")}c(ne,"parseMilliseconds");const se=c(e=>e===0||e===0n,"isZero"),oe=c((e,t)=>t===1||t===1n?e:`${e}s`,"pluralize"),re=1e-7,ce=24n*60n*60n*1000n;function I(e,t){const n=typeof e=="bigint";if(!n&&!Number.isFinite(e))throw new TypeError("Expected a finite number or bigint");t={...t};const s=e<0?"-":"";e=e<0?-e:e,t.colonNotation&&(t.compact=!1,t.formatSubMilliseconds=!1,t.separateMilliseconds=!1,t.verbose=!1),t.compact&&(t.unitCount=1,t.secondsDecimalDigits=0,t.millisecondsDecimalDigits=0);let o=[];const i=c((m,d)=>{const h=Math.floor(m*10**d+re);return(Math.round(h)/10**d).toFixed(d)},"floorDecimals"),r=c((m,d,h,l)=>{if(!((o.length===0||!t.colonNotation)&&se(m)&&!(t.colonNotation&&h==="m"))){if(l??=String(m),t.colonNotation){const T=l.includes(".")?l.split(".")[0].length:l.length,p=o.length>0?2:1;l="0".repeat(Math.max(0,p-T))+l}else l+=t.verbose?" "+oe(d,m):h;o.push(l)}},"add"),a=ne(e),u=BigInt(a.days);if(t.hideYearAndDays?r(BigInt(u)*24n+BigInt(a.hours),"hour","h"):(t.hideYear?r(u,"day","d"):(r(u/365n,"year","y"),r(u%365n,"day","d")),r(Number(a.hours),"hour","h")),r(Number(a.minutes),"minute","m"),!t.hideSeconds)if(t.separateMilliseconds||t.formatSubMilliseconds||!t.colonNotation&&e<1e3&&!t.subSecondsAsDecimals){const m=Number(a.seconds),d=Number(a.milliseconds),h=Number(a.microseconds),l=Number(a.nanoseconds);if(r(m,"second","s"),t.formatSubMilliseconds)r(d,"millisecond","ms"),r(h,"microsecond","\xB5s"),r(l,"nanosecond","ns");else{const T=d+h/1e3+l/1e6,p=typeof t.millisecondsDecimalDigits=="number"?t.millisecondsDecimalDigits:0,z=T>=1?Math.round(T):Math.ceil(T),v=p?T.toFixed(p):z;r(Number.parseFloat(v),"millisecond","ms",v)}}else{const m=(n?Number(e%ce):e)/1e3%60,d=typeof t.secondsDecimalDigits=="number"?t.secondsDecimalDigits:1,h=i(m,d),l=t.keepDecimalsOnWholeSeconds?h:h.replace(/\.0+$/,"");r(Number.parseFloat(l),"second","s",l)}if(o.length===0)return s+"0"+(t.verbose?" milliseconds":"ms");const f=t.colonNotation?":":" ";return typeof t.unitCount=="number"&&(o=o.slice(0,Math.max(t.unitCount,1))),s+o.join(f)}c(I,"prettyMilliseconds");const g=`
`,ie="    ",{log:P,error:$}=console,ae=M("\u2714"),ue=R("\u2716"),le=A("\u2022"),k=c(({startTime:e,timeout:t,endTime:n})=>{const s=(n||Date.now())-e;let o=I(s);return t&&(o+=` / ${I(t)}`),s<50?"":` ${L(`(${o})`)}`},"prettyDuration"),fe=c(e=>e.replaceAll(/^/gm,ie),"indentMultiline"),_=c(e=>{const{title:t,attempt:n,retry:s}=e;let o=`${t+k(e)}`;return s>1&&(o+=L(` (${n}/${s})`)),o},"getTestTitle"),N=c((e,t,n)=>{let s=`${ue} ${_(e)}`;n&&(s+=` [${n}]`),$(s),$(`${fe(Q.inspect(t))}
`)},"logTestFail"),de=c(e=>{P(`${ae} ${_(e)}`)},"logTestSuccess"),he=c(e=>{if(e.length===0)return;const t=[];let n=0,s=0,o,i;for(const a of e)a.startTime&&(!o||o>a.startTime)&&(o=a.startTime),a.endTime===void 0?t.push(a):((!i||i<a.endTime)&&(i=a.endTime),a.error?s+=1:n+=1);let r="";if(t.length>0){for(const a of t)r+=`${g}${le} ${a.title+k(a)}`;r+=g}r+=`${g}${L(I((i??Date.now())-o))}`,r+=g+(n>0?M:L)(`${n.toLocaleString()} passed`),s>0&&(r+=g+R(`${s.toLocaleString()} failed`)),t.length>0&&(r+=g+A(`${t.length.toLocaleString()} pending`)),r+=g,P(r)},"logReport"),me=c(()=>{let e,t;const n=new Promise((s,o)=>{e=s,t=o});return Object.assign(n,{resolve:e,reject:t})},"createDeferred"),ye=c(e=>{const t=me(),n=setTimeout(()=>t.reject(new Error(`Timeout: ${e}ms`)),e);return Object.assign(t,{timeoutId:n})},"setTimer"),ge=c((e,t)=>{if(!e||!("then"in e)||t===void 0||t===0)return e;const n=ye(t);return Promise.race([e,n]).finally(()=>{clearTimeout(n.timeoutId)})},"timeLimitFunction"),H=c(e=>{const t=[];return{addHook:c(o=>{t.push(o)},"addHook"),runHooks:c(async(...o)=>{for(const i of t)try{await i(...o)}catch(r){await e(r)}},"runHooks")}},"createHook"),Te=c(async(e,t)=>{for(let n=1;n<=t;n+=1)try{await e(n);return}catch(s){if(n===t)throw s}},"retry"),O=c(e=>(e&&typeof e=="object"&&"matcherResult"in e&&e.constructor.name==="JestAssertionError"&&delete e.matcherResult,e),"patchJestAssertionError"),q=c(async e=>{const{testFunction:t,timeout:n}=e,s=H(r=>{N(e,r,"onTestFail")}),o=c(async r=>{await s.runHooks(r)},"handleError"),i=H(async r=>{N(e,O(r),"onTestFinish")});try{await Te(async r=>{e.attempt=r,e.startTime=Date.now();try{await ge(t({onTestFail:s.addHook,onTestFinish:i.addHook}),n)}catch(a){throw N(e,O(a)),await o(a),a}finally{await i.runHooks(),e.endTime=Date.now()}de(e)},e.retry)}catch(r){e.error=r,process.exitCode=1}},"runTest"),C=[];process.on("exit",()=>{he(C)});const j=process.env.TESTONLY,V=c((e,t)=>(async(n,s,o)=>{if(e&&(n=`${e} ${n}`),j&&!n.includes(j))return;const i={title:n,testFunction:s,retry:1};o!==void 0&&(typeof o=="number"?i.timeout=o:(i.timeout=o?.timeout,o?.retry&&(i.retry=o?.retry))),C.push(i);const a=c(async()=>{if(t?.concurrencyLimiter){const u=await t.concurrencyLimiter.acquire();try{await q(i)}finally{u()}}else await q(i)},"executeTest")();t&&t.pendingTests.push(a),await a}),"createTest"),we=c(async e=>{for(;e.length>0;){const t=e.splice(0);await Promise.all(t)}},"waitAllPromises"),be=c(e=>("default"in e&&(e=e.default),"default"in e&&(e=e.default),e),"unwrapModule"),S=c(e=>{let t=typeof e=="number"?e:Y(),n=0;const s=[];let o;return e==="auto"&&(o=setInterval(()=>{const u=Y();if(u!==t)for(t=u;s.length>0&&n<t;){const f=s.shift();f&&(n+=1,f())}},5e3),o.unref()),{acquire:c(()=>n<t?(n+=1,Promise.resolve(()=>{n-=1;const u=s.shift();u&&(n+=1,u())})):new Promise(u=>{s.push(()=>{u(()=>{n-=1;const f=s.shift();f&&(n+=1,f())})})}),"acquire"),setLimit:c(u=>{for(t=u;s.length>0&&n<t;){const f=s.shift();f&&(n+=1,f())}},"setLimit"),cleanup:c(()=>{o&&clearInterval(o)},"cleanup")}},"createSemaphore"),Y=c(()=>{const e=F.cpus().length,t=F.loadavg()[0];return Math.max(1,Math.min(Math.floor(e*(1-Math.min(t/e,.8))),e))},"calculateAutoLimit"),W=c((e,t)=>(async(n,s,o)=>{e&&(n=`${e} ${n}`);const i=E(n,o?.parallel);await c(async()=>{if(t?.concurrencyLimiter){const a=await t.concurrencyLimiter.acquire();try{await i.run(s,t)}finally{a()}}else await i.run(s,t)},"executeDescribe")()}),"createDescribe"),G=c((e,t)=>((n,...s)=>{const o=c(()=>{const i=E(e);return i.run(async()=>be(await n).apply(i,s),t)},"executeTestSuite");return t?.concurrencyLimiter?t.concurrencyLimiter.acquire().then(i=>o().finally(i)):o()}),"createRunTestSuite"),U=V(),J=W(),Z=G(),E=c((e,t)=>{let n;t!==void 0&&(t===!0?n=void 0:t===!1?n=S(1):typeof t=="number"?n=S(t):t==="auto"&&(n=S("auto")));const s={pendingTests:[],callbacks:{onFinish:[]},concurrencyLimiter:n,run:c(async(o,i)=>{try{const r=(async()=>{await o(s.api),await we(s.pendingTests)})();i&&i.pendingTests.push(r),await r}catch(r){$(r),process.exitCode=1}finally{n&&n.cleanup();for(const r of s.callbacks.onFinish)try{await r()}catch(a){$(a),process.exitCode=1}}},"run")};return s.api={test:e?V(`${e} \u203A`,s):U,describe:e?W(`${e} \u203A`,s):J,runTestSuite:e?G(e,s):Z,onFinish:c(o=>{s.callbacks.onFinish.push(o)},"onFinish")},s},"createContext"),pe=E(),De=c((e,t,n)=>{const s=typeof e=="string"?e:void 0,o=typeof e=="string"?t:e,i=typeof e=="string"?n:void 0;return c(async function(...a){const u=this||pe;s?await u.api.describe(s,f=>o(f,...a),i):await o(u.api,...a)},"testSuiteWrapper")},"testSuite");Object.defineProperty(exports,"expect",{enumerable:!0,get:c(function(){return X.expect},"get")}),exports.describe=J,exports.runTestSuite=Z,exports.test=U,exports.testSuite=De;
