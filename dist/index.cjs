"use strict";var X=Object.defineProperty;var r=(e,t)=>X(e,"name",{value:t,configurable:!0});var ee=require("node:util"),R=require("node:os"),te=require("expect");let g=!0;const T=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};let w=0;if(T.process&&T.process.env&&T.process.stdout){const{FORCE_COLOR:e,NODE_DISABLE_COLORS:t,NO_COLOR:o,TERM:s,COLORTERM:n}=T.process.env;t||o||e==="0"?g=!1:e==="1"||e==="2"||e==="3"?g=!0:s==="dumb"?g=!1:"CI"in T.process.env&&["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(i=>i in T.process.env)?g=!0:g=process.stdout.isTTY,g&&(process.platform==="win32"||n&&(n==="truecolor"||n==="24bit")?w=3:s&&(s.endsWith("-256color")||s.endsWith("256"))?w=2:w=1)}let A={enabled:g,supportLevel:w};function $(e,t,o=1){const s=`\x1B[${e}m`,n=`\x1B[${t}m`,i=new RegExp(`\\x1b\\[${t}m`,"g");return a=>A.enabled&&A.supportLevel>=o?s+(""+a).replace(i,s)+n:""+a}r($,"kolorist");const L=$(2,22),S=$(31,39),M=$(32,39),P=$(33,39),B=r(e=>Number.isFinite(e)?e:0,"toZeroIfInfinity");function ne(e){return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5%24),minutes:Math.trunc(e/6e4%60),seconds:Math.trunc(e/1e3%60),milliseconds:Math.trunc(e%1e3),microseconds:Math.trunc(B(e*1e3)%1e3),nanoseconds:Math.trunc(B(e*1e6)%1e3)}}r(ne,"parseNumber");function se(e){return{days:e/86400000n,hours:e/3600000n%24n,minutes:e/60000n%60n,seconds:e/1000n%60n,milliseconds:e%1000n,microseconds:0n,nanoseconds:0n}}r(se,"parseBigint");function oe(e){switch(typeof e){case"number":{if(Number.isFinite(e))return ne(e);break}case"bigint":return se(e)}throw new TypeError("Expected a finite number or bigint")}r(oe,"parseMilliseconds");const re=r(e=>e===0||e===0n,"isZero"),ce=r((e,t)=>t===1||t===1n?e:`${e}s`,"pluralize"),ie=1e-7,ae=24n*60n*60n*1000n;function I(e,t){const o=typeof e=="bigint";if(!o&&!Number.isFinite(e))throw new TypeError("Expected a finite number or bigint");t={...t};const s=e<0?"-":"";e=e<0?-e:e,t.colonNotation&&(t.compact=!1,t.formatSubMilliseconds=!1,t.separateMilliseconds=!1,t.verbose=!1),t.compact&&(t.unitCount=1,t.secondsDecimalDigits=0,t.millisecondsDecimalDigits=0);let n=[];const i=r((f,m)=>{const h=Math.floor(f*10**m+ie);return(Math.round(h)/10**m).toFixed(m)},"floorDecimals"),a=r((f,m,h,d)=>{if(!((n.length===0||!t.colonNotation)&&re(f)&&!(t.colonNotation&&h==="m"))){if(d??=String(f),t.colonNotation){const y=d.includes(".")?d.split(".")[0].length:d.length,D=n.length>0?2:1;d="0".repeat(Math.max(0,D-y))+d}else d+=t.verbose?" "+ce(m,f):h;n.push(d)}},"add"),c=oe(e),u=BigInt(c.days);if(t.hideYearAndDays?a(BigInt(u)*24n+BigInt(c.hours),"hour","h"):(t.hideYear?a(u,"day","d"):(a(u/365n,"year","y"),a(u%365n,"day","d")),a(Number(c.hours),"hour","h")),a(Number(c.minutes),"minute","m"),!t.hideSeconds)if(t.separateMilliseconds||t.formatSubMilliseconds||!t.colonNotation&&e<1e3&&!t.subSecondsAsDecimals){const f=Number(c.seconds),m=Number(c.milliseconds),h=Number(c.microseconds),d=Number(c.nanoseconds);if(a(f,"second","s"),t.formatSubMilliseconds)a(m,"millisecond","ms"),a(h,"microsecond","\xB5s"),a(d,"nanosecond","ns");else{const y=m+h/1e3+d/1e6,D=typeof t.millisecondsDecimalDigits=="number"?t.millisecondsDecimalDigits:0,Q=y>=1?Math.round(y):Math.ceil(y),F=D?y.toFixed(D):Q;a(Number.parseFloat(F),"millisecond","ms",F)}}else{const f=(o?Number(e%ae):e)/1e3%60,m=typeof t.secondsDecimalDigits=="number"?t.secondsDecimalDigits:1,h=i(f,m),d=t.keepDecimalsOnWholeSeconds?h:h.replace(/\.0+$/,"");a(Number.parseFloat(d),"second","s",d)}if(n.length===0)return s+"0"+(t.verbose?" milliseconds":"ms");const l=t.colonNotation?":":" ";return typeof t.unitCount=="number"&&(n=n.slice(0,Math.max(t.unitCount,1))),s+n.join(l)}r(I,"prettyMilliseconds");const b=`
`,ue="    ",{log:k,error:p}=console,le=M("\u2714"),fe=S("\u2716"),de=P("\u2022"),_=r(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return L(`${t}:${o}:${s}`)},"formatTimestamp"),x=r(({startTime:e,timeout:t,endTime:o})=>{const s=(o||Date.now())-e;let n=I(s);return t&&(n+=` / ${I(t)}`),s<50?"":` ${L(`(${n})`)}`},"prettyDuration"),me=r(e=>e.replaceAll(/^/gm,ue),"indentMultiline"),H=r(e=>{const{title:t,attempt:o,retry:s}=e;let n=`${t+x(e)}`;return s>1&&(n+=L(` (${o}/${s})`)),n},"getTestTitle"),N=r((e,t,o)=>{let s=`${_()} ${fe} ${H(e)}`;o&&(s+=` [${o}]`),p(s),p(`${me(ee.inspect(t))}
`)},"logTestFail"),he=r(e=>{k(`${_()} ${le} ${H(e)}`)},"logTestSuccess"),ge=r(e=>{if(e.length===0)return;const t=[];let o=0,s=0,n,i;for(const c of e)c.startTime&&(!n||n>c.startTime)&&(n=c.startTime),c.endTime===void 0?t.push(c):((!i||i<c.endTime)&&(i=c.endTime),c.error?s+=1:o+=1);let a="";if(t.length>0){for(const c of t)a+=`${b}${de} ${c.title+x(c)}`;a+=b}a+=`${b}${L(I((i??Date.now())-n))}`,a+=b+(o>0?M:L)(`${o.toLocaleString()} passed`),s>0&&(a+=b+S(`${s.toLocaleString()} failed`)),t.length>0&&(a+=b+P(`${t.length.toLocaleString()} pending`)),a+=b,k(a)},"logReport"),be=r(()=>{let e,t;const o=new Promise((s,n)=>{e=s,t=n});return Object.assign(o,{resolve:e,reject:t})},"createDeferred"),ye=r((e,t)=>{const o=be(),s=setTimeout(()=>{const n=new Error(`Timeout: ${e}ms`);t?.abort(n),o.reject(n)},e);return Object.assign(o,{timeoutId:s})},"setTimer"),O=r((e,t,o)=>{if(!e||!("then"in e)||t===void 0||t===0)return e;const s=ye(t,o);return Promise.race([e,s]).finally(()=>{clearTimeout(s.timeoutId)})},"timeLimitFunction"),q=r(e=>{const t=[];return{addHook:r(n=>{t.push(n)},"addHook"),runHooks:r(async(...n)=>{for(const i of t)try{await i(...n)}catch(a){await e(a)}},"runHooks")}},"createHook"),Te=r(async(e,t)=>{for(let o=1;o<=t;o+=1)try{await e(o);return}catch(s){if(o===t)throw s}},"retry"),C=r(e=>(e&&typeof e=="object"&&"matcherResult"in e&&e.constructor.name==="JestAssertionError"&&delete e.matcherResult,e),"patchJestAssertionError"),j=r(async(e,t)=>{const{testFunction:o,timeout:s}=e,n=q(c=>{N(e,c,"onTestFail")}),i=r(async c=>{await n.runHooks(c)},"handleError"),a=q(async c=>{N(e,C(c),"onTestFinish")});try{await Te(async c=>{e.attempt=c,e.startTime=Date.now();const u=new AbortController;let l;t&&(l=r(()=>{u.signal.aborted||u.abort(t.abortController.signal.reason)},"handleParentAbort"),t.abortController.signal.addEventListener("abort",l),t.abortController.signal.aborted&&l());try{await O(o({signal:u.signal,onTestFail:n.addHook,onTestFinish:a.addHook}),s,u)}catch(f){throw N(e,C(f)),await i(f),f}finally{t&&l&&t.abortController.signal.removeEventListener("abort",l),u.signal.aborted||u.abort(),await a.runHooks(),e.endTime=Date.now()}he(e)},e.retry)}catch(c){e.error=c,process.exitCode=1}},"runTest"),V=[];process.on("exit",()=>{ge(V)});const Y=process.env.TESTONLY,W=r((e,t)=>(async(o,s,n)=>{if(e&&(o=`${e} ${o}`),Y&&!o.includes(Y))return;const i={title:o,testFunction:s,retry:1};n!==void 0&&(typeof n=="number"?i.timeout=n:(i.timeout=n?.timeout,n?.retry&&(i.retry=n?.retry))),V.push(i);const c=r(async()=>{if(t?.concurrencyLimiter){const u=await t.concurrencyLimiter.acquire();try{await j(i,t)}finally{u()}}else await j(i,t)},"executeTest")();t&&t.pendingTests.push(c),await c}),"createTest"),we=r(async e=>{for(;e.length>0;){const t=e.splice(0);await Promise.all(t)}},"waitAllPromises"),Le=r(e=>("default"in e&&(e=e.default),"default"in e&&(e=e.default),e),"unwrapModule"),v=r(e=>{let t=typeof e=="number"?e:G(),o=0;const s=[];let n;return e==="auto"&&(n=setInterval(()=>{const u=G();if(u!==t)for(t=u;s.length>0&&o<t;){const l=s.shift();l&&(o+=1,l())}},5e3),n.unref()),{acquire:r(()=>o<t?(o+=1,Promise.resolve(()=>{o-=1;const u=s.shift();u&&(o+=1,u())})):new Promise(u=>{s.push(()=>{u(()=>{o-=1;const l=s.shift();l&&(o+=1,l())})})}),"acquire"),setLimit:r(u=>{for(t=u;s.length>0&&o<t;){const l=s.shift();l&&(o+=1,l())}},"setLimit"),cleanup:r(()=>{n&&clearInterval(n)},"cleanup")}},"createSemaphore"),G=r(()=>{const e=R.cpus().length,t=R.loadavg()[0];return Math.max(1,Math.min(Math.floor(e*(1-Math.min(t/e,.8))),e))},"calculateAutoLimit"),U=r((e,t)=>(async(o,s,n)=>{e&&(o=`${e} ${o}`);const i=E(o,n?.parallel,n?.timeout);await r(async()=>{if(t?.concurrencyLimiter){const c=await t.concurrencyLimiter.acquire();try{await i.run(s,t)}finally{c()}}else await i.run(s,t)},"executeDescribe")()}),"createDescribe"),J=r((e,t)=>((o,...s)=>{const n=r(()=>{const i=E(e);return i.run(async()=>Le(await o).apply(i,s),t)},"executeTestSuite");return t?.concurrencyLimiter?t.concurrencyLimiter.acquire().then(i=>n().finally(i)):n()}),"createRunTestSuite"),Z=W(),z=U(),K=J(),E=r((e,t,o)=>{let s;t!==void 0&&(t===!0?s=void 0:t===!1?s=v(1):typeof t=="number"?s=v(t):t==="auto"&&(s=v("auto")));const n=new AbortController,i={pendingTests:[],callbacks:{onFinish:[]},concurrencyLimiter:s,abortController:n,timeout:o,run:r(async(a,c)=>{let u;c&&(u=r(()=>{n.signal.aborted||n.abort(c.abortController.signal.reason)},"handleParentAbort"),c.abortController.signal.addEventListener("abort",u),c.abortController.signal.aborted&&u());try{const l=(async()=>{await a(i.api),await we(i.pendingTests)})();c&&c.pendingTests.push(l),await O(l,o,n)}catch(l){p(l),process.exitCode=1}finally{c&&u&&c.abortController.signal.removeEventListener("abort",u),n.signal.aborted||n.abort(),s&&s.cleanup();for(const l of i.callbacks.onFinish)try{await l()}catch(f){p(f),process.exitCode=1}}},"run")};return i.api={signal:n.signal,test:e?W(`${e} \u203A`,i):Z,describe:e?U(`${e} \u203A`,i):z,runTestSuite:e?J(e,i):K,onFinish:r(a=>{i.callbacks.onFinish.push(a)},"onFinish")},i},"createContext"),De=E(),$e=r((e,t,o)=>{const s=typeof e=="string"?e:void 0,n=typeof e=="string"?t:e,i=typeof e=="string"?o:void 0;return r(async function(...c){const u=this||De;s?await u.api.describe(s,l=>n(l,...c),i):await n(u.api,...c)},"testSuiteWrapper")},"testSuite"),pe=r(e=>{setTimeout(()=>{process.exitCode=1,console.error(S(`\u2716 Process timed out after ${e}ms`)),setImmediate(()=>process.exit(1))},e).unref()},"setProcessTimeout");Object.defineProperty(exports,"expect",{enumerable:!0,get:r(function(){return te.expect},"get")}),exports.describe=z,exports.runTestSuite=K,exports.setProcessTimeout=pe,exports.test=Z,exports.testSuite=$e;
