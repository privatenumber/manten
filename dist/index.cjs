"use strict";var X=Object.defineProperty;var o=(e,t)=>X(e,"name",{value:t,configurable:!0});var ee=require("node:util"),F=require("node:os"),te=require("expect");let g=!0;const w=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};let T=0;if(w.process&&w.process.env&&w.process.stdout){const{FORCE_COLOR:e,NODE_DISABLE_COLORS:t,NO_COLOR:r,TERM:s,COLORTERM:n}=w.process.env;t||r||e==="0"?g=!1:e==="1"||e==="2"||e==="3"?g=!0:s==="dumb"?g=!1:"CI"in w.process.env&&["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(i=>i in w.process.env)?g=!0:g=process.stdout.isTTY,g&&(process.platform==="win32"||n&&(n==="truecolor"||n==="24bit")?T=3:s&&(s.endsWith("-256color")||s.endsWith("256"))?T=2:T=1)}let R={enabled:g,supportLevel:T};function $(e,t,r=1){const s=`\x1B[${e}m`,n=`\x1B[${t}m`,i=new RegExp(`\\x1b\\[${t}m`,"g");return a=>R.enabled&&R.supportLevel>=r?s+(""+a).replace(i,s)+n:""+a}o($,"kolorist");const L=$(2,22),A=$(31,39),M=$(32,39),P=$(33,39),B=o(e=>Number.isFinite(e)?e:0,"toZeroIfInfinity");function ne(e){return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5%24),minutes:Math.trunc(e/6e4%60),seconds:Math.trunc(e/1e3%60),milliseconds:Math.trunc(e%1e3),microseconds:Math.trunc(B(e*1e3)%1e3),nanoseconds:Math.trunc(B(e*1e6)%1e3)}}o(ne,"parseNumber");function se(e){return{days:e/86400000n,hours:e/3600000n%24n,minutes:e/60000n%60n,seconds:e/1000n%60n,milliseconds:e%1000n,microseconds:0n,nanoseconds:0n}}o(se,"parseBigint");function re(e){switch(typeof e){case"number":{if(Number.isFinite(e))return ne(e);break}case"bigint":return se(e)}throw new TypeError("Expected a finite number or bigint")}o(re,"parseMilliseconds");const oe=o(e=>e===0||e===0n,"isZero"),ce=o((e,t)=>t===1||t===1n?e:`${e}s`,"pluralize"),ie=1e-7,ae=24n*60n*60n*1000n;function S(e,t){const r=typeof e=="bigint";if(!r&&!Number.isFinite(e))throw new TypeError("Expected a finite number or bigint");t={...t};const s=e<0?"-":"";e=e<0?-e:e,t.colonNotation&&(t.compact=!1,t.formatSubMilliseconds=!1,t.separateMilliseconds=!1,t.verbose=!1),t.compact&&(t.unitCount=1,t.secondsDecimalDigits=0,t.millisecondsDecimalDigits=0);let n=[];const i=o((f,m)=>{const h=Math.floor(f*10**m+ie);return(Math.round(h)/10**m).toFixed(m)},"floorDecimals"),a=o((f,m,h,d)=>{if(!((n.length===0||!t.colonNotation)&&oe(f)&&!(t.colonNotation&&h==="m"))){if(d??=String(f),t.colonNotation){const y=d.includes(".")?d.split(".")[0].length:d.length,D=n.length>0?2:1;d="0".repeat(Math.max(0,D-y))+d}else d+=t.verbose?" "+ce(m,f):h;n.push(d)}},"add"),c=re(e),l=BigInt(c.days);if(t.hideYearAndDays?a(BigInt(l)*24n+BigInt(c.hours),"hour","h"):(t.hideYear?a(l,"day","d"):(a(l/365n,"year","y"),a(l%365n,"day","d")),a(Number(c.hours),"hour","h")),a(Number(c.minutes),"minute","m"),!t.hideSeconds)if(t.separateMilliseconds||t.formatSubMilliseconds||!t.colonNotation&&e<1e3&&!t.subSecondsAsDecimals){const f=Number(c.seconds),m=Number(c.milliseconds),h=Number(c.microseconds),d=Number(c.nanoseconds);if(a(f,"second","s"),t.formatSubMilliseconds)a(m,"millisecond","ms"),a(h,"microsecond","\xB5s"),a(d,"nanosecond","ns");else{const y=m+h/1e3+d/1e6,D=typeof t.millisecondsDecimalDigits=="number"?t.millisecondsDecimalDigits:0,Q=y>=1?Math.round(y):Math.ceil(y),E=D?y.toFixed(D):Q;a(Number.parseFloat(E),"millisecond","ms",E)}}else{const f=(r?Number(e%ae):e)/1e3%60,m=typeof t.secondsDecimalDigits=="number"?t.secondsDecimalDigits:1,h=i(f,m),d=t.keepDecimalsOnWholeSeconds?h:h.replace(/\.0+$/,"");a(Number.parseFloat(d),"second","s",d)}if(n.length===0)return s+"0"+(t.verbose?" milliseconds":"ms");const u=t.colonNotation?":":" ";return typeof t.unitCount=="number"&&(n=n.slice(0,Math.max(t.unitCount,1))),s+n.join(u)}o(S,"prettyMilliseconds");const b=`
`,le="    ",{log:k,error:p}=console,ue=M("\u2714"),fe=A("\u2716"),de=P("\u2022"),_=o(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return L(`${t}:${r}:${s}`)},"formatTimestamp"),H=o(({startTime:e,timeout:t,endTime:r})=>{const s=(r||Date.now())-e;let n=S(s);return t&&(n+=` / ${S(t)}`),s<50?"":` ${L(`(${n})`)}`},"prettyDuration"),me=o(e=>e.replaceAll(/^/gm,le),"indentMultiline"),O=o(e=>{const{title:t,attempt:r,retry:s}=e;let n=`${t+H(e)}`;return s>1&&(n+=L(` (${r}/${s})`)),n},"getTestTitle"),I=o((e,t,r)=>{let s=`${_()} ${fe} ${O(e)}`;r&&(s+=` [${r}]`),p(s),p(`${me(ee.inspect(t))}
`)},"logTestFail"),he=o(e=>{k(`${_()} ${ue} ${O(e)}`)},"logTestSuccess"),ge=o(e=>{if(e.length===0)return;const t=[];let r=0,s=0,n,i;for(const c of e)c.startTime&&(!n||n>c.startTime)&&(n=c.startTime),c.endTime===void 0?t.push(c):((!i||i<c.endTime)&&(i=c.endTime),c.error?s+=1:r+=1);let a="";if(t.length>0){for(const c of t)a+=`${b}${de} ${c.title+H(c)}`;a+=b}a+=`${b}${L(S((i??Date.now())-n))}`,a+=b+(r>0?M:L)(`${r.toLocaleString()} passed`),s>0&&(a+=b+A(`${s.toLocaleString()} failed`)),t.length>0&&(a+=b+P(`${t.length.toLocaleString()} pending`)),a+=b,k(a)},"logReport"),be=o(()=>{let e,t;const r=new Promise((s,n)=>{e=s,t=n});return Object.assign(r,{resolve:e,reject:t})},"createDeferred"),ye=o((e,t)=>{const r=be(),s=setTimeout(()=>{const n=new Error(`Timeout: ${e}ms`);t?.abort(n),r.reject(n)},e);return Object.assign(r,{timeoutId:s})},"setTimer"),q=o((e,t,r)=>{if(!e||!("then"in e)||t===void 0||t===0)return e;const s=ye(t,r);return Promise.race([e,s]).finally(()=>{clearTimeout(s.timeoutId)})},"timeLimitFunction"),x=o(e=>{const t=[];return{addHook:o(n=>{t.push(n)},"addHook"),runHooks:o(async(...n)=>{for(const i of t)try{await i(...n)}catch(a){await e(a)}},"runHooks")}},"createHook"),we=o(async(e,t)=>{for(let r=1;r<=t;r+=1)try{await e(r);return}catch(s){if(r===t)throw s}},"retry"),j=o(e=>(e&&typeof e=="object"&&"matcherResult"in e&&e.constructor.name==="JestAssertionError"&&delete e.matcherResult,e),"patchJestAssertionError"),C=o(async(e,t)=>{const{testFunction:r,timeout:s}=e,n=x(c=>{I(e,c,"onTestFail")}),i=o(async c=>{await n.runHooks(c)},"handleError"),a=x(async c=>{I(e,j(c),"onTestFinish")});try{await we(async c=>{e.attempt=c,e.startTime=Date.now();const l=new AbortController;let u;t&&(u=o(()=>{l.signal.aborted||l.abort(t.abortController.signal.reason)},"handleParentAbort"),t.abortController.signal.addEventListener("abort",u),t.abortController.signal.aborted&&u());try{await q(r({signal:l.signal,onTestFail:n.addHook,onTestFinish:a.addHook}),s,l)}catch(f){throw I(e,j(f)),await i(f),f}finally{t&&u&&t.abortController.signal.removeEventListener("abort",u),l.signal.aborted||l.abort(),await a.runHooks(),e.endTime=Date.now()}he(e)},e.retry)}catch(c){e.error=c,process.exitCode=1}},"runTest"),V=[];process.on("exit",()=>{ge(V)});const Y=process.env.TESTONLY,W=o((e,t)=>(async(r,s,n)=>{if(e&&(r=`${e} ${r}`),Y&&!r.includes(Y))return;const i={title:r,testFunction:s,retry:1};n!==void 0&&(typeof n=="number"?i.timeout=n:(i.timeout=n?.timeout,n?.retry&&(i.retry=n?.retry))),V.push(i);const c=o(async()=>{if(t?.concurrencyLimiter){const l=await t.concurrencyLimiter.acquire();try{await C(i,t)}finally{l()}}else await C(i,t)},"executeTest")();t&&t.pendingTests.push(c),await c}),"createTest"),Te=o(async e=>{for(;e.length>0;){const t=e.splice(0);await Promise.all(t)}},"waitAllPromises"),Le=o(e=>("default"in e&&(e=e.default),"default"in e&&(e=e.default),e),"unwrapModule"),N=o(e=>{let t=typeof e=="number"?e:G(),r=0;const s=[];let n;return e==="auto"&&(n=setInterval(()=>{const l=G();if(l!==t)for(t=l;s.length>0&&r<t;){const u=s.shift();u&&(r+=1,u())}},5e3),n.unref()),{acquire:o(()=>r<t?(r+=1,Promise.resolve(()=>{r-=1;const l=s.shift();l&&(r+=1,l())})):new Promise(l=>{s.push(()=>{l(()=>{r-=1;const u=s.shift();u&&(r+=1,u())})})}),"acquire"),setLimit:o(l=>{for(t=l;s.length>0&&r<t;){const u=s.shift();u&&(r+=1,u())}},"setLimit"),cleanup:o(()=>{n&&clearInterval(n)},"cleanup")}},"createSemaphore"),G=o(()=>{const e=F.cpus().length,t=F.loadavg()[0];return Math.max(1,Math.min(Math.floor(e*(1-Math.min(t/e,.8))),e))},"calculateAutoLimit"),U=o((e,t)=>(async(r,s,n)=>{e&&(r=`${e} ${r}`);const i=v(r,n?.parallel,n?.timeout);await o(async()=>{if(t?.concurrencyLimiter){const c=await t.concurrencyLimiter.acquire();try{await i.run(s,t)}finally{c()}}else await i.run(s,t)},"executeDescribe")()}),"createDescribe"),J=o((e,t)=>((r,...s)=>{const n=o(()=>{const i=v(e);return i.run(async()=>Le(await r).apply(i,s),t)},"executeTestSuite");return t?.concurrencyLimiter?t.concurrencyLimiter.acquire().then(i=>n().finally(i)):n()}),"createRunTestSuite"),Z=W(),z=U(),K=J(),v=o((e,t,r)=>{let s;t!==void 0&&(t===!0?s=void 0:t===!1?s=N(1):typeof t=="number"?s=N(t):t==="auto"&&(s=N("auto")));const n=new AbortController,i={pendingTests:[],callbacks:{onFinish:[]},concurrencyLimiter:s,abortController:n,timeout:r,run:o(async(a,c)=>{let l;c&&(l=o(()=>{n.signal.aborted||n.abort(c.abortController.signal.reason)},"handleParentAbort"),c.abortController.signal.addEventListener("abort",l),c.abortController.signal.aborted&&l());try{const u=(async()=>{await a(i.api),await Te(i.pendingTests)})();c&&c.pendingTests.push(u),await q(u,r,n)}catch(u){p(u),process.exitCode=1}finally{c&&l&&c.abortController.signal.removeEventListener("abort",l),n.signal.aborted||n.abort(),s&&s.cleanup();for(const u of i.callbacks.onFinish)try{await u()}catch(f){p(f),process.exitCode=1}}},"run")};return i.api={signal:n.signal,test:e?W(`${e} \u203A`,i):Z,describe:e?U(`${e} \u203A`,i):z,runTestSuite:e?J(e,i):K,onFinish:o(a=>{i.callbacks.onFinish.push(a)},"onFinish")},i},"createContext"),De=v(),$e=o((e,t,r)=>{const s=typeof e=="string"?e:void 0,n=typeof e=="string"?t:e,i=typeof e=="string"?r:void 0;return o(async function(...c){const l=this||De;s?await l.api.describe(s,u=>n(u,...c),i):await n(l.api,...c)},"testSuiteWrapper")},"testSuite");Object.defineProperty(exports,"expect",{enumerable:!0,get:o(function(){return te.expect},"get")}),exports.describe=z,exports.runTestSuite=K,exports.test=Z,exports.testSuite=$e;
