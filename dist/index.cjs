"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var A=require("expect");let f=!0;const h=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};let b=0;if(h.process&&h.process.env&&h.process.stdout){const{FORCE_COLOR:t,NODE_DISABLE_COLORS:e,NO_COLOR:s,TERM:r}=h.process.env;e||s||t==="0"?f=!1:t==="1"||t==="2"||t==="3"?f=!0:r==="dumb"?f=!1:"CI"in h.process.env&&["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(c=>c in h.process.env)?f=!0:f=process.stdout.isTTY,f&&(b=r&&r.endsWith("-256color")?2:1)}let w={enabled:f,supportLevel:b};function g(t,e,s=1){const r=`\x1B[${t}m`,c=`\x1B[${e}m`,n=new RegExp(`\\x1b\\[${e}m`,"g");return o=>w.enabled&&w.supportLevel>=s?r+(""+o).replace(n,r)+c:""+o}const p=g(2,22),D=g(31,39),$=g(32,39),x=g(33,39);function F(t){if(typeof t!="number")throw new TypeError("Expected a number");const e=t>0?Math.floor:Math.ceil;return{days:e(t/864e5),hours:e(t/36e5)%24,minutes:e(t/6e4)%60,seconds:e(t/1e3)%60,milliseconds:e(t)%1e3,microseconds:e(t*1e3)%1e3,nanoseconds:e(t*1e6)%1e3}}const j=(t,e)=>e===1?t:`${t}s`,V=1e-7;function y(t,e={}){if(!Number.isFinite(t))throw new TypeError("Expected a finite number");e.colonNotation&&(e.compact=!1,e.formatSubMilliseconds=!1,e.separateMilliseconds=!1,e.verbose=!1),e.compact&&(e.secondsDecimalDigits=0,e.millisecondsDecimalDigits=0);const s=[],r=(o,i)=>{const a=Math.floor(o*10**i+V);return(Math.round(a)/10**i).toFixed(i)},c=(o,i,a,l)=>{if((s.length===0||!e.colonNotation)&&o===0&&!(e.colonNotation&&a==="m"))return;l=(l||o||"0").toString();let m,u;if(e.colonNotation){m=s.length>0?":":"",u="";const _=l.includes(".")?l.split(".")[0].length:l.length,P=s.length>0?2:1;l="0".repeat(Math.max(0,P-_))+l}else m="",u=e.verbose?" "+j(i,o):a;s.push(m+l+u)},n=F(t);if(c(Math.trunc(n.days/365),"year","y"),c(n.days%365,"day","d"),c(n.hours,"hour","h"),c(n.minutes,"minute","m"),e.separateMilliseconds||e.formatSubMilliseconds||!e.colonNotation&&t<1e3)if(c(n.seconds,"second","s"),e.formatSubMilliseconds)c(n.milliseconds,"millisecond","ms"),c(n.microseconds,"microsecond","\xB5s"),c(n.nanoseconds,"nanosecond","ns");else{const o=n.milliseconds+n.microseconds/1e3+n.nanoseconds/1e6,i=typeof e.millisecondsDecimalDigits=="number"?e.millisecondsDecimalDigits:0,a=o>=1?Math.round(o):Math.ceil(o),l=i?o.toFixed(i):a;c(Number.parseFloat(l),"millisecond","ms",l)}else{const o=t/1e3%60,i=typeof e.secondsDecimalDigits=="number"?e.secondsDecimalDigits:1,a=r(o,i),l=e.keepDecimalsOnWholeSeconds?a:a.replace(/\.0+$/,"");c(Number.parseFloat(l),"second","s",l)}if(s.length===0)return"0"+(e.verbose?" milliseconds":"ms");if(e.compact)return s[0];if(typeof e.unitCount=="number"){const o=e.colonNotation?"":" ";return s.slice(0,Math.max(e.unitCount,1)).join(o)}return e.colonNotation?s.join(""):s.join(" ")}const d=`
`,{log:I,error:T}=console,v=$("\u2714"),B=D("\u2716"),G=x("\u2022"),E=({startTime:t,timeout:e,endTime:s})=>{const r=(s||Date.now())-t;let c=y(r);return e&&(c+=` / ${y(e)}`),r<50?"":` ${p(`(${c})`)}`},O=t=>{const{title:e,error:s}=t;(s?T:I)(`${s?B:v} ${e+E(t)}`)},U=t=>{if(t.length===0)return;const e=[];let s=0,r=0,c,n;for(const i of t)i.startTime&&(!c||c>i.startTime)&&(c=i.startTime),i.endTime===void 0?e.push(i):((!n||n<i.endTime)&&(n=i.endTime),i.error?r+=1:s+=1);let o="";if(e.length>0){for(const i of e)o+=`${d}${G} ${i.title+E(i)}`;o+=d}o+=`${d}${p(y(n-c))}`,o+=d+(s>0?$:p)(`${s.toLocaleString()} passed`),r>0&&(o+=d+D(`${r.toLocaleString()} failed`)),e.length>0&&(o+=d+x(`${e.length.toLocaleString()} pending`)),o+=d,I(o)},k=async(t,e)=>new Promise((s,r)=>{e.timeoutId=setTimeout(()=>{r(new Error(`Timeout: ${t}ms`))},t)}),W=async t=>{const{testFunction:e,timeout:s}=t;let r;const c={onTestFail(n){r=n}};t.startTime=Date.now();try{if(s){const n={timeoutId:void 0};try{await Promise.race([e(c),k(s,n)])}finally{clearTimeout(n.timeoutId)}}else await e(c);t.endTime=Date.now(),O(t)}catch(n){t.endTime=Date.now(),t.error=n,O(t),n&&typeof n=="object"&&"matcherResult"in n&&n.constructor.name==="JestAssertionError"&&delete n.matcherResult,T(n),process.exitCode=1,typeof r=="function"&&r(n)}},N=[];process.on("exit",()=>{U(N)});function S(t,e){return async function(r,c,n){t&&(r=`${t} ${r}`);const o={title:r,testFunction:c,timeout:n};N.push(o);const i=W(o);e&&e.push(i),await i}}async function Y(t){for(;t.length>0;){const e=t.splice(0);await Promise.all(e)}}function C(t,e){return async function(r,c){t&&(r=`${t} ${r}`);const n=[];try{const o=(async()=>{const i={test:S(`${r} \u203A`,n),describe:C(`${r} \u203A`,n),runTestSuite:(a,...l)=>{const m=(async()=>{let u=await a;return"default"in u&&(u=u.default),"default"in u&&(u=u.default),u.apply(i,l)})();return n.push(m),m}};await c(i),await Y(n)})();e&&e.push(o),await o}catch(o){T(o),process.exitCode=1}}}const R=S(),L=C(),M={describe:L,test:R,runTestSuite:async(t,...e)=>{let s=await t;return"default"in s&&(s=s.default),"default"in s&&(s=s.default),s.apply(M,e)}};function q(t){return function(...e){return t(this||M,...e)}}Object.defineProperty(exports,"expect",{enumerable:!0,get:function(){return A.expect}}),exports.describe=L,exports.test=R,exports.testSuite=q;
